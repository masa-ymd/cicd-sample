# フロントエンドインフラストラクチャ

このモジュールは、フロントエンドアプリケーションのインフラストラクチャを管理します。

## 構成要素

- **S3バケット**: フロントエンドの静的ファイルを保存
- **CloudFront**: コンテンツ配信ネットワーク
- **OAI (Origin Access Identity)**: S3へのアクセスをCloudFrontに制限

## S3ディレクトリ構造

フロントエンドのデプロイとロールバックをサポートするために、以下のディレクトリ構造を使用します：

```
s3://cicd-sample-frontend-[env]/
  ├── current/           # CloudFrontから参照される現在のアクティブなバージョン
  ├── v1.0.0/            # セマンティックバージョニングによるバージョン
  ├── v1.1.0/            # 別のセマンティックバージョン
  ├── develop-abc123-20230815/ # 開発環境の特定のコミットバージョン
  ├── prod-def456-20230815/    # 本番環境の特定のコミットバージョン
  └── backup-20230815-120000/  # ロールバック前の自動バックアップ
```

## 設計上の考慮事項

### ディレクトリベースのバージョニング

モダンなフロントエンドフレームワーク（React等）では、ビルド時にファイル名にハッシュが付加されます（例: `main.a1b2c3d4.js`）。
このため、S3のオブジェクトバージョニングではなく、ディレクトリベースのバージョニングを採用しています。

CloudFrontは常に `/current` ディレクトリを参照し、デプロイやロールバックはこのディレクトリの内容を更新することで行われます。

### ロールバックプロセス

ロールバックは以下のプロセスで行われます：

1. 現在の `/current` の内容を `/backup-[timestamp]` にバックアップ
2. 指定されたバージョンディレクトリから `/current` へファイルをコピー
3. CloudFrontキャッシュを無効化

### 自動バックアップ

デプロイとロールバックの両方で、現在の `/current` ディレクトリの内容が自動的にバックアップされます。
これにより、問題が発生した場合でも以前の状態に戻すことができます。 